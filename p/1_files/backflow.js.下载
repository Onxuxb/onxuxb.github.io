!function(){function e(e,n,t){var i=t?t:location.href,o=i.slice(i.indexOf("?"));return new RegExp("([?]|&)"+e+"=*([^&]*)(&|$)").test(i)?i=i.replace(new RegExp("([?]|&)"+e+"=*([^&]*)(&|$)"),"$1"+e+"="+n+"$3"):i+=("?"==o.slice(0,1)?"&":"?")+e+"="+n,i}String.prototype.versionSubtract=function(e){e=e?e+"":"0";for(var n,t,i=this.split(/[.\-_]/),o=e.split(/[.\-_]/),a=Math.max(i.length,o.length),l=0,r=0;r<a&&(n=(i[r]||0)-0,t=(o[r]||0)-0,l=n-t,0==l);r++);return l};var n=navigator.userAgent,t={linkElement:null,config:{iosStoreUrl:"https://itunes.apple.com/cn/app/huyou/id1354304906",guideLayerAndroidDownloadUrl:"https://w.sohu.com/sohu-huyou.apk?t="+(new Date).getTime(),universalLinkUrl:"https://applinks.w.sohu.com",universalMinVersion:"9.3",guidePicPath:"//hy-web2.bjcnc.scs.sohucs.com/js-sdk/backflow/1-lastest/img/guide/"},guideLayerDownloadLog:{eventKey:"C_DOWNLOAD_GUIDE_DOWNLOAD",params:{subChannelId:""}},protocol:null,loadedCall:!1,h5ExtraChannel:!1,callTimestamp:0,appHasInstall:!1,appInstallJudgeTime:3e3,init:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;t.protocol=n.protocol||t.getH5Protocol(n.url),t.loadedCall=n.loadedCall,n.guideLayerAndroidDownloadUrl&&(t.config.guideLayerAndroidDownloadUrl=n.guideLayerAndroidDownloadUrl);var i=n.subChannelId||n.subChannelid||t.getQS("subChannelId")||"";t.guideLayerDownloadLog.params.subChannelId=i,t.h5ExtraChannel=!!n.h5ExtraChannel,i&&(t.config.universalLinkUrl=e("subChannelId",i,t.config.universalLinkUrl)),t.h5ExtraChannel&&(t.config.universalLinkUrl=e("h5ExtraChannel",1,t.config.universalLinkUrl)),t.pageInit(),n.linkElement&&t.callBtnInit(n),document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState&&(new Date).getTime()-t.callTimestamp<t.appInstallJudgeTime&&(t.appHasInstall=!0)}),document.addEventListener("onvisibilitychange",function(){"hidden"==document.visibilityState&&(new Date).getTime()-t.callTimestamp<t.appInstallJudgeTime&&(t.appHasInstall=!0)})},getH5Protocol:function(e){var n="sohuhy://w.sohu.com/browser?url="+encodeURIComponent(e||location.href);return n},uaInfo:{mobile:!!n.match(/(iPhone|iPad|iPod|iOS|android)/i),ios:n.match(/OS ([\d_]+) like Mac OS X/),android:n.match(/Android ([\d.]+)/),chrome:n.match(/Chrome\/([\d.]+)/),uc:n.match(/UCBrowser[\/\s]?([\w\.]+)/i),samsung:n.match(/SamsungBrowser\/([\d.]+)/),sohunews:n.match(/SohuNews/),sohusns:n.match(/SohuSNS\/([\d.]+)/),sohuhy:n.match(/sohuhy\/([\d.]+)/i),weibo:n.match(/__weibo__([\d.]+)/),weixin:n.match(/MicroMessenger\/([\d.]+)/),qq:n.match(/QQ\/([\d.]+)/),qqbrowser:n.match(/MQQBrowser\/([\d.]+)/),wkwebview:n.match(/WKWebView/i)},getQS:function(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),t=(location.search||location.hash).match(/\?(.+)/),i=(t?t[1]:"").match(n);return null!=i?decodeURIComponent(i[2]):null},pageInit:function(){var e=this;if(e.callTimestamp=(new Date).getTime(),e.loadedCall&&!e.uaInfo.sohusns&&!e.uaInfo.sohuhy&&!(e.uaInfo.sohusns||e.uaInfo.weixin||e.uaInfo.weibo||e.uaInfo.qq))if(e.uaInfo.sohunews)location.href=e.protocol;else if(e.uaInfo.ios&&e.uaInfo.ios[1].versionSubtract(e.config.universalMinVersion)>0)if(e.uaInfo.weixin||e.uaInfo.qq||e.uaInfo.weibo)e.showGuide();else{if(/^10_[0-3]_/.test(e.uaInfo.ios[1]))return void this.callNativeByLocationHref(e.protocol,!1);e.openNative(e.protocol,!1,!1)}else e.openNative(e.protocol,!1,!0)},callBtnInit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this;if(e.linkElement){var t=e.protocol||n.getH5Protocol(e.url),i=e.subChannelId||e.subChannelid||n.getQS("subChannelId")||"";n.guideLayerDownloadLog.params.subChannelId=i,n.linkElement=e.linkElement,n.linkElement.href="javascript:;",n.linkElement.addEventListener("click",function(e){n.call(e,t)},!1),n.uaInfo.sohuhy?n.linkElement.href=t:n.uaInfo.weixin||n.uaInfo.weibo||n.uaInfo.qq||n.uaInfo.ios&&n.uaInfo.ios[1].versionSubtract(n.config.universalMinVersion)<0&&(n.linkElement.href=t)}},call:function(e,n){var t=this;if(!t.uaInfo.sohuhy){if(n=n||t.protocol,t.appHasInstall=!1,t.callTimestamp=(new Date).getTime(),"javascript:;"!=t.linkElement.href)return void t.delay2download(2500);setTimeout(function(){t.openNative(n,!0,!0)},100),e&&e.preventDefault()}},hyClipboardInit:function(e){var n=e.clipboardJSConstructor,t=e.selectors,i=e.huPassword||"",o=this.guideLayerDownloadLog.params.subChannelId,a="hy#"+i+"#"+o;return this.h5ExtraChannel&&(this.guideLayerClipboard=new n("a[event-flag='backflow-guide-download']",{text:function(){return a+"_H5Guide"}})),new n(t,{text:function(){return a}})},callHuyou:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sohuhy://",n=this;e=/^sohuhy/.test(e)?e:n.getH5Protocol(e),n.openNative(e,!0,!0)},openNative:function(e,n,t){var i=this;return i.protocol=e,i.uaInfo.sohuhy?void i.callNativeByLocationHref(e):i.uaInfo.mobile?void(!(i.uaInfo.ios&&i.uaInfo.ios[1].versionSubtract(i.config.universalMinVersion)>=0)||i.uaInfo.weixin||i.uaInfo.sohuhy||i.uaInfo.qq&&(i.uaInfo.wkwebview||i.uaInfo.ios[1].versionSubtract("11")<0)?i.uaInfo.weixin||i.uaInfo.qq||i.uaInfo.weibo?n&&i.showGuide():i.openNativeInBrowser(e,t):i.iosUniversalOpen(e)):void(location.href=i.getFinalApplinksUrl(e))},getFinalApplinksUrl:function(n){return e("url",encodeURIComponent(n||this.protocol),this.config.universalLinkUrl)},iosUniversalOpen:function(e){var n=this;e=n.getFinalApplinksUrl(e);var t="ios_link_"+(new Date).getTime(),i="<a href='"+e+"' style='display:none;' id='"+t+"'></a>";document.body.insertAdjacentHTML("beforeend",i);var o=document.getElementById(t),a=document.createEvent("MouseEvent");a.initEvent("click",!1,!1),o.dispatchEvent(a),o.remove()},showGuide:function(){var e=this,n=e.config.guidePicPath,t="android";e.uaInfo.ios&&(t="ios");var i={top:n+"top-"+t+".png",bottom_left:n+"bottom-left.png",bottom_right:n+"bottom-right.png"},o={ios:'<a event-flag="backflow-guide-download" data-href="'+e.config.iosStoreUrl+'">去App Store下载</a>',android:'<a event-flag="backflow-guide-download" data-href="'+e.config.guideLayerAndroidDownloadUrl+'">立即下载</a>'},a=['<div class="hy-guide-layer" event-flag="layerClose">','<style type="text/css"> .hy-guide-layer {position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; z-index: 100000; background: url('+i.bottom_left+") left bottom no-repeat/18vmin 20vmin, url("+i.bottom_right+") right bottom no-repeat/68vmin 76vmin; background-color: #fff; user-select: none;-webkit-user-select: none;-webkit-tap-highlight-color: rgba(0,0,0,0); } .hy-guide-layer .uninstall {position: fixed; bottom: 0; right: 0; width: 59vmin; height: 67vmin; text-align: center; box-sizing: border-box; padding: 27vmin 0 0 5vmin; } .hy-guide-layer .uninstall>* {font-family: PingFangSC-Regular; font-size: 5vmin; color: #454545; margin: 0 auto;}.hy-guide-layer .uninstall .download-box{margin-top: 5vmin;} .hy-guide-layer .uninstall a {display: inline-block;color: #000; font-size: 4vmin; padding: 0 4vmin;height: 10vmin; line-height: 10vmin; border-radius: 1vmin; background: #fdd536;text-decoration: none; outline: none; border: none; } </style>",'<img src="'+i.top+'" style="width:100%">','<div class="uninstall">',"<p><b>未安装</b> 狐友APP</p>",'<p class="download-box">'+o[t]+"</p>","</div>","</div>"].join(" ");document.body.insertAdjacentHTML("beforeend",a),this.guideLayerEventInit()},guideLayerEventInit:function(){var e=this,n=document.querySelector(".hy-guide-layer");n.addEventListener("click",function(t){var i=t.target.getAttribute("event-flag");switch(i){case"backflow-guide-download":var o=e.guideLayerDownloadLog,a=200;setTimeout(function(){n.remove(),location.href=t.target.getAttribute("data-href")},a),window.backflow.pbLog({uniqueName:o.eventKey,publicData:{subChannelId:o.params.subChannelId},businessData:{}});break;default:n.remove()}},!1)},openNativeInBrowser:function(e,n){var t=this;t.uaInfo.ios?t.uaInfo.ios[1].versionSubtract(8)<0?t.callNativeByIframe(e,n):t.callNativeByLocationHref(e,n):t.uaInfo.android&&(t.uaInfo.uc||t.uaInfo.samsung||t.uaInfo.chrome&&t.uaInfo.chrome[1].versionSubtract("56.1")>0?t.callNativeByLocationHref(e,n):t.callNativeByIframe(e,n))},callNativeByLocationHref:function(e,n){var t=this;setTimeout(function(){window.location.href=e},0),n&&t.delay2download(2e3)},callNativeByIframe:function(e,n){var t=this,i=setTimeout(function(){var n=document.createElement("iframe");n.setAttribute("style","display:none;"),n.setAttribute("src",e),document.body.appendChild(n),n.remove(),clearTimeout(i)},0);n&&t.delay2download()},callNativeByAClick:function(e,n){var t=this,i=setTimeout(function(){var n="callNative_"+(new Date).getTime(),t="<a href='"+e+"' style='display:none;width:100%;height:10px;' id='"+n+"'></a>";document.body.insertAdjacentHTML("beforeend",t);var o=document.getElementById(n),a=document.createEvent("MouseEvent");a.initEvent("click",!1,!1),o.dispatchEvent(a),o.remove(),clearTimeout(i)},0);n&&t.delay2download()},delay2download:function(e){var n=this;void 0==e&&(e=2e3),e=e<n.appInstallJudgeTime?n.appInstallJudgeTime:e,setTimeout(function(){n.appHasInstall||(location.href=n.config.universalLinkUrl,location.href=n.getFinalApplinksUrl())},e)},Ajax:function(e){var n=new XMLHttpRequest;if(n.open(e.type,e.url,!0),"post"==e.type.toLowerCase()&&n.setRequestHeader("Content-type",e.contentType||"application/x-www-form-urlencoded"),e.headers)for(var t in e.headers)n.setRequestHeader(t,e.headers[t]);n.onreadystatechange=function(){if(2==n.readyState)e.complete&&e.complete();else if(4==n.readyState){var t=n.responseText,i=/^\{.+\}$/.test(t)?JSON.parse(t):{};n.status>=200&&n.status<300||304==n.status?e.success&&e.success.call(this,i):e.error&&e.error.call(this,i)}},"post"==e.type.toLowerCase()?n.send(JSON.stringify(e.data)):n.send(null)},pbLog:function(e){var n={},t=e.uniqueName,i=e.type,o=e.publicData,a=e.businessData,l=navigator.userAgent,r=(new Date).getTime(),s={deviceId:"",sessionId:"",userId:"",passportId:"",tel:"",channelId:"",subChannelId:"",createTime:r,submitTime:r,version:"",os:/Android ([\d.]+)/.test(l)?"O_ANDROID":/OS ([\d_]+) like Mac OS X/.test(l)?"O_IOS":"O_OTHER"},u={pv:{publicEvent:"E_PAGE_VIEW",businessKey:"pageViewMeta",flagKeyInBusiness:"pageEnum",flagValPrefix:"P_"},click:{publicEvent:"E_CLICK",businessKey:"clickMeta",flagKeyInBusiness:"clickPosition",flagValPrefix:"C_"},ev:{publicEvent:"E_ELEMENT_VIEW",businessKey:"elementViewMeta",flagKeyInBusiness:"viewElement",flagValPrefix:"V_"}};if(!i)for(var c in u)if(0==t.indexOf(u[c].flagValPrefix)){i=c;break}o=Object.assign(s,o),o.event=u[i].publicEvent,n.publicMeta=o,a=a||{};var d=u[i].flagKeyInBusiness;a[d]=a[d]||t,n[u[i].businessKey]=a;var f={product:"opapi-ol.sns.sohu.com",test:"opapi-test.sns.sohu.com"},h=!/sohu/.test(location.host)||/-(test|dev)/.test(location.host)||/^t\.w/.test(location.host)?"test":"product",p="//"+f[h]+"/openapi/pingback/log/h5Report";this.Ajax({url:p,data:n,type:"post",contentType:"application/json",success:function(e){},error:function(e){},complete:function(){}})},wxShare:{loadScript:function(e,n){var t=document.createElement("script");t.style.display="none",t.src=e;var i=function(){t&&t.readyState&&"loaded"!=t.readyState&&"complete"!=t.readyState||(t.onload=t.onreadystatechange=t.onerror=null,t.src="",t.parentNode.removeChild(t),t=null,n&&"function"==typeof n&&n())};t.onload=t.onerror=t.onreadystatechange=i,document.getElementsByTagName("body")[0].appendChild(t)},init:function(e){this.setData(e).bindInit()},data:{},setData:function(n){var t=this,i=n.title||"打开狐友客户端",o=n.content||"立即下载狐友客户端",a=n.link||e("snstimestamp",Date.parse(new Date)),l=n.pic||"https://cache.k.sohu.com/img8/wb/logo/share/share_normal.png",r="狐友:【"+i+"】"+a+"（分享自 @狐友客户端）";return t.data={Default:{title:i,pic:l,content:o,link:a},Weibo:{content:r},timeline:{pic:n.timelinePic||l}},t},bindInit:function(){var e=this,n=e.data;e.loadScript("//res.wx.qq.com/open/js/jweixin-1.0.0.js",function(){t.Ajax({url:"//wechat-public.sohusce.com/generate-sign?url="+location.href,type:"get",success:function(e){var t=e.data;wx.config({debug:!1,appId:"wx28b768f133d71388",timestamp:t.timestamp,nonceStr:t.noncestr,signature:t.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:n.Default.title,link:n.Default.link,imgUrl:n.timeline.pic,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:n.Default.title,desc:n.Default.content,link:n.Default.link,imgUrl:n.Default.pic,type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:n.Default.title,desc:n.Default.content,link:n.Default.link,imgUrl:n.Default.pic,success:function(){},cancel:function(){}})}),wx.error(function(){})}})})}},initQQShare:function(e){if(this.uaInfo.qq){var n=function(e){var n=document.createElement("meta");for(var t in e)n.setAttribute(t,e[t]);document.head.appendChild(n)};n({itemprop:"name",content:e.title}),n({itemprop:"image",content:e.pic}),n({name:"description",itemprop:"description",content:e.content}),this.wxShare.loadScript("//open.mobile.qq.com/sdk/qqapi.js",function(){function n(){try{e.callback?window.mqq.ui.setOnShareHandler(function(n){3==n&&e.timelineTitle?t.title=e.timelineTitle:t.title=e.title,t.share_type=n,t.back=!0,window.mqq.ui.shareMessage(t,function(n){0===n.retCode&&e.callback&&e.callback.call(this,n)})}):window.mqq.data.setShareInfo(t)}catch(n){}}var t={title:e.title,desc:e.content,share_url:e.url,image_url:e.pic};n()})}}};t.version="1.4.1.1555574643396","undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.backflow=t}();